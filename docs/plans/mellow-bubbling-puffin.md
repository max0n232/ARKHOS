# –ü–ª–∞–Ω: –ö–æ–Ω—Ç–µ–Ω—Ç-–ó–∞–≤–æ–¥ –¥–ª—è Studiok√∂√∂k

## –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Å–æ—Ü—Å–µ—Ç–∏ —á–µ—Ä–µ–∑ n8n workflows —Å Telegram-—Ç—Ä–∏–≥–≥–µ—Ä–æ–º.

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å 95% –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ Telegram –¥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Instagram, Facebook, Telegram, TikTok.

**–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:**
- n8n (self-hosted –Ω–∞ https://n8n.studiokook.ee)
- KIE.ai API –¥–ª—è AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- WordPress NextGEN Gallery (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö —Ñ–æ—Ç–æ)
- Telegram Bot (—Ç—Ä–∏–≥–≥–µ—Ä –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- Meta Business API (Instagram/Facebook)
- OpenAI GPT-4 (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö n8n Workflow:

```
Telegram Bot
     ‚îÇ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. Master Router   ‚îÇ ‚Üê –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº    ‚ñº    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇContent‚îÇ ‚îÇSched‚îÇ ‚îÇPubli ‚îÇ ‚îÇGalle ‚îÇ
‚îÇ Gen   ‚îÇ ‚îÇuler ‚îÇ ‚îÇsher  ‚îÇ ‚îÇry   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ              ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚ñº
    [–í—Å–µ —Å–æ—Ü—Å–µ—Ç–∏]
```

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (2-3 —á–∞—Å–∞)

#### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Bot
**–§–∞–π–ª:** n8n workflow `TG_Bot_Setup`

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å Telegram Bot —á–µ—Ä–µ–∑ BotFather (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
2. –ü–æ–ª—É—á–∏—Ç—å Bot Token
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ n8n credentials (`telegram_bot_studiokook`)
4. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π webhook workflow:
   - –ù–æ–¥–∞: `Telegram Trigger` ‚Üí webhook mode
   - URL: `https://n8n.studiokook.ee/webhook/telegram-content-factory`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/start` –±–æ—Ç—É, –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.

#### 1.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π
**–õ–æ–∫–∞—Ü–∏—è:** n8n Credentials Manager

–°–æ–∑–¥–∞—Ç—å credentials –¥–ª—è:
- **KIE.ai API Key**
  - Type: Header Auth
  - Name: `Authorization`
  - Value: `Bearer [API_KEY]`

- **OpenAI API Key**
  - Type: OpenAI API

- **Pexels API Key**
  - Type: Header Auth
  - Name: `Authorization`

- **Meta Business Access Token**
  - Type: OAuth2
  - Scope: `instagram_basic`, `instagram_content_publish`, `pages_read_engagement`, `pages_manage_posts`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π credential —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç–æ–π HTTP Request.

---

### –§–∞–∑–∞ 2: Master Router Workflow (1-2 —á–∞—Å–∞)

**–§–∞–π–ª:** `ContentFactory_MasterRouter.json`

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow:

```
Telegram Trigger
    ‚Üì
Code: Parse Command
    ‚Üì
Switch: Command Type
    ‚îú‚Üí /create_post ‚Üí Execute: Content Generator
    ‚îú‚Üí /schedule ‚Üí Execute: Scheduler
    ‚îú‚Üí /publish ‚Üí Execute: Publisher
    ‚îú‚Üí /gallery ‚Üí Execute: Gallery Browser
    ‚îú‚Üí /status ‚Üí Query: Schedule DB
    ‚îú‚Üí /help ‚Üí Telegram: Send Help
    ‚îî‚Üí default ‚Üí Telegram: Error message
```

#### –ö–ª—é—á–µ–≤—ã–µ –Ω–æ–¥—ã:

**1. Telegram Trigger**
- Updates: `message`, `callback_query`
- Mode: Webhook

**2. Code Node: Command Parser**
```javascript
const message = $input.item.json.message?.text || '';
const userId = $input.item.json.message?.from.id;
const chatId = $input.item.json.message?.chat.id;

// Parse command
const commandMatch = message.match(/^\/(\w+)(?:\s+(.*))?$/);
if (!commandMatch) {
  return {
    error: true,
    message: 'Invalid command. Type /help'
  };
}

const [, command, params] = commandMatch;

return {
  command,
  params: params || '',
  user_id: userId,
  chat_id: chatId,
  timestamp: new Date().toISOString()
};
```

**3. Switch Node**
- Mode: Rules
- Routes:
  - `{{ $json.command === 'create_post' }}`
  - `{{ $json.command === 'schedule' }}`
  - `{{ $json.command === 'publish' }}`
  - `{{ $json.command === 'gallery' }}`
  - `{{ $json.command === 'status' }}`
  - `{{ $json.command === 'help' }}`

**4. Execute Workflow Nodes** (–ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ route)
- Wait for sub-workflow: ‚úì Yes

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
- `n8n_workflows/master_router.json`
- `config/telegram_commands.json` (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
/help ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
/create_post ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å Content Generator
/gallery ‚Üí –∑–∞–ø—É—Å—Ç–∏—Ç—å Gallery Browser
```

---

### –§–∞–∑–∞ 3: Content Generator Workflow (4-5 —á–∞—Å–æ–≤)

**–§–∞–π–ª:** `ContentFactory_ContentGenerator.json`

–≠—Ç–æ —Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π workflow. –†–∞–∑–¥–µ–ª–∏–º –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏:

#### 3.1 –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –º–µ–¥–∏–∞

**Switch Node: Media Source Selection**

–õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞:
- 70% –ø–æ—Å—Ç–æ–≤: WordPress Gallery (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- 30% –ø–æ—Å—Ç–æ–≤: KIE.ai –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ($0.04/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
- Fallback: Pexels (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –µ—Å–ª–∏ AI fail)

```javascript
// Code Node: Select Source
const random = Math.random();
const hasGalleryPhotos = true; // TODO: check WordPress

if (hasGalleryPhotos && random < 0.7) {
  return { source: 'wordpress' };
} else if (random < 0.95) {
  return { source: 'ai' };
} else {
  return { source: 'pexels' };
}
```

#### 3.2 Route A: WordPress Gallery

**HTTP Request Node: WordPress MCP**
```
Method: POST
URL: {{$env.WORDPRESS_MCP_URL}}/execute-ability
Body:
{
  "ability_name": "ngg-gallery/list-galleries",
  "parameters": {}
}
```

**Code Node: Pick Random Gallery**
```javascript
const galleries = $input.item.json.galleries;
const randomGallery = galleries[Math.floor(Math.random() * galleries.length)];
return { gallery_id: randomGallery.id };
```

**HTTP Request Node: Get Images**
```
Method: POST
Body:
{
  "ability_name": "ngg-gallery/list-images",
  "parameters": {
    "gallery_id": "{{$json.gallery_id}}"
  }
}
```

**Code Node: Pick Random Image**
```javascript
const images = $input.item.json.images;
const randomImage = images[Math.floor(Math.random() * images.length)];
return {
  image_url: randomImage.url,
  image_description: randomImage.description || randomImage.alttext || '',
  source: 'wordpress',
  cost: 0
};
```

#### 3.3 Route B: AI Generation (KIE.ai)

**Code Node: Create AI Prompt**
```javascript
const prompts = [
  'modern Scandinavian kitchen design, bright natural light, minimalist, wood accents --ar 4:5 --v 6',
  'luxury Estonian kitchen interior, marble countertops, professional lighting --ar 4:5 --v 6',
  'cozy kitchen with island, warm atmosphere, family-friendly design --ar 4:5 --v 6',
  'contemporary kitchen with smart storage solutions, clean lines --ar 4:5 --v 6'
];

const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];

return {
  prompt: randomPrompt,
  model: 'midjourney', // or 'flux1' for cheaper
  aspect_ratio: '4:5'
};
```

**HTTP Request Node: KIE.ai Generate**
```
Method: POST
URL: https://api.kie.ai/v1/generate/image
Headers:
  Authorization: Bearer {{$credentials.kieai.apiKey}}
  Content-Type: application/json
Body:
{
  "model": "{{$json.model}}",
  "prompt": "{{$json.prompt}}",
  "aspect_ratio": "{{$json.aspect_ratio}}",
  "quality": "high"
}
```

**Wait Node** (–µ—Å–ª–∏ KIE.ai –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç job_id)
- Mode: Webhook response
- Resume on: Polling KIE.ai status endpoint
- Timeout: 5 minutes

**Error Handler:** IF KIE.ai fails ‚Üí Switch to Pexels

#### 3.4 Route C: Pexels Fallback

**HTTP Request Node: Pexels API**
```
Method: GET
URL: https://api.pexels.com/v1/search
Query Parameters:
  query: modern kitchen design
  per_page: 15
  orientation: portrait
Headers:
  Authorization: {{$credentials.pexels.apiKey}}
```

**Code Node: Random Pick**
```javascript
const photos = $input.item.json.photos;
const random = photos[Math.floor(Math.random() * photos.length)];

return {
  image_url: random.src.large2x,
  photographer: random.photographer,
  attribution: `Photo by ${random.photographer} on Pexels`,
  source: 'pexels',
  cost: 0
};
```

#### 3.5 Merge Routes ‚Üí Text Generation

**Merge Node** (wait for all routes)

**OpenAI Node: Analyze Image (Vision API)**
```
Resource: Chat
Model: gpt-4-vision-preview
Messages:
[
  {
    "role": "user",
    "content": [
      {
        "type": "text",
        "text": "Analyze this kitchen image briefly: style, key features, color palette, mood. Keep it 2-3 sentences."
      },
      {
        "type": "image_url",
        "image_url": {
          "url": "{{$json.image_url}}"
        }
      }
    ]
  }
]
```

**Parallel Text Generation:**

**Branch A: Estonian Text**
```
OpenAI Node:
Model: gpt-4-turbo
Prompt:
Loo k√∂itev Instagram postitus k√∂√∂gidisaini kohta.

Kontekst: {{$json.image_description}}

N√µuded:
- Pikkus: 150-200 t√§hem√§rki
- Tooni: professionaalne, inspireeriv
- Lisa kutse tegutsemisele (CTA)
- Kasuta 2-3 emoji'sid
- L√µpu lisa 5-7 hashtag'i (#k√∂√∂k #k√∂√∂gim√∂√∂bel #tallinn jne)

Formaat:
[K√∂itev hook] [emoji]
[P√µhis√µnum]
[Detail]

[CTA] üëâ [Tegevus]

#hashtag1 #hashtag2 ...
```

**Branch B: Russian Text**
```
OpenAI Node:
Model: gpt-4-turbo
Prompt:
–°–æ–∑–¥–∞–π —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç –¥–ª—è Instagram –æ –¥–∏–∑–∞–π–Ω–µ –∫—É—Ö–Ω–∏.

–ö–æ–Ω—Ç–µ–∫—Å—Ç: {{$json.image_description}}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –î–ª–∏–Ω–∞: 150-200 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–æ–Ω: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–π
- –î–æ–±–∞–≤—å –ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)
- –ò—Å–ø–æ–ª—å–∑—É–π 2-3 —ç–º–æ–¥–∑–∏
- –í –∫–æ–Ω—Ü–µ –¥–æ–±–∞–≤—å 5-7 —Ö—ç—à—Ç–µ–≥–æ–≤ (#–∫—É—Ö–Ω—è #–¥–∏–∑–∞–π–Ω #—Ç–∞–ª–ª–∏–Ω–Ω –∏ —Ç.–¥.)

–§–æ—Ä–º–∞—Ç:
[–ó–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π —Ö—É–∫] [emoji]
[–û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ]
[–î–µ—Ç–∞–ª—å]

[CTA] üëâ [–î–µ–π—Å—Ç–≤–∏–µ]

#—Ö—ç—à—Ç–µ–≥1 #—Ö—ç—à—Ç–µ–≥2 ...
```

**Merge Texts:**

**Code Node: Combine Bilingual Text**
```javascript
const textEt = $node["OpenAI Estonian"].json.choices[0].message.content;
const textRu = $node["OpenAI Russian"].json.choices[0].message.content;

return {
  text_combined: `${textEt}\n\n---\n\n${textRu}`,
  text_estonian: textEt,
  text_russian: textRu
};
```

#### 3.6 Platform Optimization

**Code Node: Optimize for Each Platform**
```javascript
const truncate = (str, max) => str.length > max ? str.substring(0, max - 3) + '...' : str;

const media = {
  url: $json.image_url,
  source: $json.source
};

return {
  draft_id: crypto.randomUUID(),
  created_at: new Date().toISOString(),
  platforms: {
    instagram: {
      text: $json.text_combined.substring(0, 2200),
      media: { url: media.url, aspect_ratio: '4:5' },
      enabled: true
    },
    facebook: {
      text: $json.text_combined,
      media: { url: media.url, aspect_ratio: '1.91:1' },
      enabled: true
    },
    telegram: {
      text: `*${$json.text_estonian}*\n\n${$json.text_russian}`,
      media: { url: media.url },
      parse_mode: 'Markdown',
      enabled: true
    },
    tiktok: {
      text: truncate($json.text_combined, 150),
      media: { url: media.url },
      enabled: false // –¢—Ä–µ–±—É–µ—Ç –≤–∏–¥–µ–æ
    }
  },
  metadata: {
    source: media.source,
    cost_usd: media.source === 'ai' ? 0.04 : 0
  }
};
```

#### 3.7 Save Draft

**Google Drive Node: Create Draft File**
```
Operation: Upload
Parent Folder: ContentFactory/Drafts/{{$now.format('YYYY-MM')}}
File Name: draft_{{$json.draft_id}}.json
Content: {{JSON.stringify($json, null, 2)}}
```

#### 3.8 Send Preview to Telegram

**Code Node: Create Preview Message**
```javascript
const draft = $json;
const previewText = `
üì± *–ù–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≥–æ—Ç–æ–≤!*

üá™üá™ ${draft.platforms.instagram.text.substring(0, 100)}...

üá∑üá∫ ${draft.platforms.telegram.text.substring(0, 100)}...

üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: $${draft.metadata.cost_usd}
üì∏ –ò—Å—Ç–æ—á–Ω–∏–∫: ${draft.metadata.source}

ID: \`${draft.draft_id}\`
`;

return {
  text: previewText,
  draft_id: draft.draft_id,
  media_url: draft.platforms.instagram.media.url
};
```

**Telegram Node: Send Photo with Inline Keyboard**
```
Operation: Send Photo
Chat ID: {{$node["Telegram Trigger"].json.message.chat.id}}
Photo: {{$json.media_url}}
Caption: {{$json.text}}
Parse Mode: Markdown
Reply Markup:
{
  "inline_keyboard": [
    [
      {"text": "‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å", "callback_data": "publish_now_{{$json.draft_id}}"},
      {"text": "üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å", "callback_data": "schedule_{{$json.draft_id}}"}
    ],
    [
      {"text": "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "callback_data": "edit_{{$json.draft_id}}"},
      {"text": "üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å", "callback_data": "regenerate_{{$json.draft_id}}"}
    ],
    [
      {"text": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", "callback_data": "discard_{{$json.draft_id}}"}
    ]
  ]
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
- `n8n_workflows/content_generator.json`
- `config/ai_prompts.json` (—à–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤)
- `config/platform_specs.json` (—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
/create_post ‚Üí –¥–æ–ª–∂–µ–Ω:
1. –í—ã–±—Ä–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –º–µ–¥–∏–∞
2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –°–æ–∑–¥–∞—Ç—å –±–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å preview –≤ Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏
```

---

### –§–∞–∑–∞ 4: Publisher Workflow (3-4 —á–∞—Å–∞)

**–§–∞–π–ª:** `ContentFactory_Publisher.json`

#### Trigger

**Execute Workflow Trigger** OR **Telegram Callback Query**

**IF Node: Check Trigger Type**
- IF callback_query ‚Üí Extract draft_id
- IF execute_workflow ‚Üí Use provided draft_id

#### Load Draft

**Google Drive Node: Get Draft File**
```
Operation: Download
File ID: Search by name "draft_{{$json.draft_id}}.json"
```

**Code Node: Parse Draft JSON**
```javascript
const draftContent = JSON.parse($input.item.binary.data.toString('utf8'));
return draftContent;
```

#### Parallel Publication

**Switch Node: Publication Strategy**
- Mode: Parallel (–≤—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- Timeout: 5 min per branch

**Branch 1: Instagram (—á–µ—Ä–µ–∑ Meta Graph API)**

**Function Node: Instagram Preparation**
```javascript
// Instagram requires 2-step process:
// 1. Create media container
// 2. Publish container

return {
  image_url: $json.platforms.instagram.media.url,
  caption: $json.platforms.instagram.text,
  instagram_account_id: '{{$env.INSTAGRAM_ACCOUNT_ID}}'
};
```

**HTTP Request: Create Media Container**
```
Method: POST
URL: https://graph.facebook.com/v18.0/{{$json.instagram_account_id}}/media
Body:
{
  "image_url": "{{$json.image_url}}",
  "caption": "{{$json.caption}}",
  "access_token": "{{$credentials.meta.accessToken}}"
}
```

**HTTP Request: Publish Media**
```
Method: POST
URL: https://graph.facebook.com/v18.0/{{$json.instagram_account_id}}/media_publish
Body:
{
  "creation_id": "{{$json.id}}",
  "access_token": "{{$credentials.meta.accessToken}}"
}
```

**Branch 2: Facebook**

**HTTP Request: Facebook Post**
```
Method: POST
URL: https://graph.facebook.com/v18.0/{{$env.FACEBOOK_PAGE_ID}}/photos
Body:
{
  "url": "{{$json.platforms.facebook.media.url}}",
  "message": "{{$json.platforms.facebook.text}}",
  "published": true,
  "access_token": "{{$credentials.meta.accessToken}}"
}
```

**Branch 3: Telegram Channel**

**Telegram Node: Send Photo**
```
Operation: Send Photo
Chat ID: @studiokook_channel  // –∏–ª–∏ ID –∫–∞–Ω–∞–ª–∞
Photo: {{$json.platforms.telegram.media.url}}
Caption: {{$json.platforms.telegram.text}}
Parse Mode: {{$json.platforms.telegram.parse_mode}}
```

**Branch 4: TikTok (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –≤–∏–¥–µ–æ)**

**IF Node: Check if Video Available**
```javascript
return $json.platforms.tiktok.enabled && $json.platforms.tiktok.media.type === 'video';
```

**HTTP Request: Blotato API (TikTok uploader)**
```
Method: POST
URL: https://api.blotato.com/v1/tiktok/upload
Headers:
  Authorization: Bearer {{$credentials.blotato.apiKey}}
Body:
{
  "video_url": "{{$json.platforms.tiktok.media.url}}",
  "caption": "{{$json.platforms.tiktok.text}}",
  "privacy_level": "PUBLIC_TO_EVERYONE"
}
```

#### Merge Results

**Merge Node** (wait for all branches)

**Code Node: Analyze Publication Results**
```javascript
const results = {
  instagram: $node["Instagram Publish"].json,
  facebook: $node["Facebook Post"].json,
  telegram: $node["Telegram Send"].json
};

const successful = [];
const failed = [];

Object.entries(results).forEach(([platform, result]) => {
  if (result.error || !result.id) {
    failed.push({
      platform,
      error: result.error?.message || 'Unknown error'
    });
  } else {
    successful.push({
      platform,
      post_id: result.id,
      url: generatePostUrl(platform, result.id)
    });
  }
});

return {
  successful,
  failed,
  total: Object.keys(results).length,
  success_rate: successful.length / Object.keys(results).length
};
```

#### Error Handling & Retry

**IF Node: Has Failed Publications?**
```javascript
return $json.failed.length > 0;
```

**IF Yes ‚Üí Loop Node** (max 3 retries)

**Wait Node** (exponential backoff: 30s, 60s, 120s)

**Execute Workflow: Retry Publication** (recursive call)

#### Update Draft Status

**Google Drive Node: Update Draft File**
```
Operation: Update
File ID: {{$json.draft_file_id}}
Content:
{
  ...draft,
  status: 'published',
  published_at: new Date().toISOString(),
  publication_results: $json.successful
}
```

#### Send Report to User

**Code Node: Create Report**
```javascript
const { successful, failed } = $json;

let report = 'üìä *–û—Ç—á—ë—Ç –æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏*\n\n';

if (successful.length > 0) {
  report += '‚úÖ *–£—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:*\n';
  successful.forEach(p => {
    report += `‚Ä¢ ${p.platform}: ${p.url}\n`;
  });
}

if (failed.length > 0) {
  report += '\n‚ùå *–û—à–∏–±–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:*\n';
  failed.forEach(p => {
    report += `‚Ä¢ ${p.platform}: ${p.error}\n`;
  });
}

report += `\nüìà –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${Math.round($json.success_rate * 100)}%`;

return { text: report };
```

**Telegram Node: Send Report**
```
Operation: Send Message
Chat ID: {{$node["Telegram Trigger"].json.message.chat.id}}
Text: {{$json.text}}
Parse Mode: Markdown
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
- `n8n_workflows/publisher.json`
- `config/platform_api_endpoints.json`
- `scripts/retry_logic.js` (–¥–ª—è —Å–ª–æ–∂–Ω–æ–π retry –ª–æ–≥–∏–∫–∏)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π draft
2. –í—ã–∑–≤–∞—Ç—å Publisher —Å draft_id
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å retry –ª–æ–≥–∏–∫—É (–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É)

---

### –§–∞–∑–∞ 5: Scheduler Workflow (1-2 —á–∞—Å–∞)

**–§–∞–π–ª:** `ContentFactory_Scheduler.json`

#### Main Scheduler Workflow

**Execute Workflow Trigger**

**Code Node: Parse Schedule Request**
```javascript
// Expects: draft_id, scheduled_datetime (ISO 8601)
const { draft_id, scheduled_datetime } = $json;

const scheduledDate = new Date(scheduled_datetime);
const now = new Date();

if (scheduledDate <= now) {
  throw new Error('Scheduled time must be in the future');
}

// Convert to Estonia timezone (UTC+2/+3)
const estoniaTime = new Intl.DateTimeFormat('en-US', {
  timeZone: 'Europe/Tallinn',
  year: 'numeric',
  month: '2-digit',
  day: '2-digit',
  hour: '2-digit',
  minute: '2-digit',
  second: '2-digit',
  hour12: false
}).format(scheduledDate);

return {
  draft_id,
  scheduled_datetime: scheduledDate.toISOString(),
  estonia_time: estoniaTime,
  status: 'scheduled'
};
```

**Google Sheets Node: Add to Schedule**
```
Operation: Append Row
Spreadsheet: ContentFactory Schedule
Sheet: Schedule
Values:
[
  "{{$json.draft_id}}",
  "{{$json.scheduled_datetime}}",
  "{{$json.status}}",
  "{{$now.toISOString()}}"
]
```

**Telegram Node: Confirmation**
```
Text:
üìÖ *–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞!*

Draft ID: `{{$json.draft_id}}`
–î–∞—Ç–∞: {{$json.estonia_time}} (EET)

–°—Ç–∞—Ç—É—Å: ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ
```

#### Schedule Executor Workflow (Cron-based)

**–§–∞–π–ª:** `ContentFactory_ScheduleExecutor.json`

**Schedule Trigger**
```
Rule: */15 * * * *  (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
```

**Google Sheets Node: Get Pending Posts**
```
Operation: Lookup
Spreadsheet: ContentFactory Schedule
Criteria:
  status = 'scheduled'
  AND scheduled_datetime <= NOW() + 15 minutes
```

**IF Node: Has Posts?**
```javascript
return $json.posts && $json.posts.length > 0;
```

**Split In Batches Node**
```
Batch Size: 1
```

**Execute Workflow: Publisher**
```
Workflow: ContentFactory_Publisher
Data:
{
  "draft_id": "{{$json.draft_id}}"
}
Wait for Completion: Yes
```

**Google Sheets Node: Update Status**
```
Operation: Update Row
Set:
  status = 'published' | 'failed'
  published_at = NOW()
```

**Telegram Node: Notify User**
```
Text:
üöÄ *–ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!*

Draft ID: `{{$json.draft_id}}`
–†–µ–∑—É–ª—å—Ç–∞—Ç: {{$json.status}}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
- `n8n_workflows/scheduler.json`
- `n8n_workflows/schedule_executor.json`
- Google Sheet: `ContentFactory Schedule`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
1. /schedule <draft_id> <future_datetime>
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ Google Sheets
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—é
```

---

### –§–∞–∑–∞ 6: Gallery Browser Workflow (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1-2 —á–∞—Å–∞)

**–§–∞–π–ª:** `ContentFactory_GalleryBrowser.json`

–£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ –∏–∑ WordPress –≤—Ä—É—á–Ω—É—é.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≥–∞–ª–µ—Ä–µ–π (WordPress MCP)
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram —Å Inline Keyboard
3. –ü–æ –≤—ã–±–æ—Ä—É –≥–∞–ª–µ—Ä–µ–∏ ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ç–æ
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é —Ñ–æ—Ç–æ —Å –∫–Ω–æ–ø–∫–æ–π [Use This]
5. –ü–æ –∫–ª–∏–∫—É ‚Üí Trigger Content Generator —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–æ—Ç–æ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
- `n8n_workflows/gallery_browser.json`

---

## Verification Plan (–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)

### 1. –ú–æ–¥—É–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ —Ñ–∞–∑–∞–º)

**–ü–æ—Å–ª–µ –§–∞–∑—ã 1:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram Bot
curl -X POST "https://api.telegram.org/bot<TOKEN>/sendMessage" \
  -d "chat_id=<YOUR_CHAT_ID>" \
  -d "text=Test message"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å n8n credentials
# –í n8n UI: Settings ‚Üí Credentials ‚Üí Test –∫–∞–∂–¥—ã–π credential
```

**–ü–æ—Å–ª–µ –§–∞–∑—ã 2:**
```
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram –±–æ—Ç:
/help
–û–∂–∏–¥–∞–µ—Ç—Å—è: —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

/unknown_command
–û–∂–∏–¥–∞–µ—Ç—Å—è: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
```

**–ü–æ—Å–ª–µ –§–∞–∑—ã 3:**
```
# –¢–µ—Å—Ç Content Generator:
/create_post

–û–∂–∏–¥–∞–µ—Ç—Å—è:
1. –ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç (20-60 —Å–µ–∫)
2. –ü–æ–ª—É—á–∞–µ—Ç–µ preview —Å —Ñ–æ—Ç–æ
3. –¢–µ–∫—Å—Ç –Ω–∞ —ç—Å—Ç–æ–Ω—Å–∫–æ–º –∏ —Ä—É—Å—Å–∫–æ–º
4. –ö–Ω–æ–ø–∫–∏ [Publish] [Schedule] [Edit] [Discard]
```

**–ü–æ—Å–ª–µ –§–∞–∑—ã 4:**
```
# –¢–µ—Å—Ç Publisher:
1. –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç —á–µ—Ä–µ–∑ /create_post
2. –ù–∞–∂–∞—Ç—å [‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å]
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é:
   - Instagram: https://instagram.com/studiokook.ee
   - Facebook: https://facebook.com/<PAGE>
   - Telegram: https://t.me/<CHANNEL>

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—á—ë—Ç –≤ Telegram
```

**–ü–æ—Å–ª–µ –§–∞–∑—ã 5:**
```
# –¢–µ—Å—Ç Scheduler:
/schedule <draft_id> 2026-02-06T15:00:00

–û–∂–∏–¥–∞–µ—Ç—Å—è:
1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. –ó–∞–ø–∏—Å—å –≤ Google Sheets
3. –ê–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**End-to-End —Ç–µ—Å—Ç:**
```
–°—Ü–µ–Ω–∞—Ä–∏–π A: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å WordPress Gallery

1. /create_post
2. –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–æ—Ç–æ –∏–∑ WordPress
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—ã (ET + RU)
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç preview
5. –ù–∞–∂–∞—Ç—å [Publish]
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—á—ë—Ç

–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 2-3 –º–∏–Ω—É—Ç—ã
–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $0.02 (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç)
```

**–°—Ü–µ–Ω–∞—Ä–∏–π B: AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**
```
1. /create_post
2. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ KIE.ai
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—ã
4. –ù–∞–∂–∞—Ç—å [Schedule]
5. –í–≤–µ—Å—Ç–∏ –¥–∞—Ç—É/–≤—Ä–µ–º—è
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
7. –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏

–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è: 3-5 –º–∏–Ω—É—Ç
–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $0.06 (AI image + —Ç–µ–∫—Å—Ç)
```

### 3. –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞ fallback-–æ–≤:**
```
1. –û—Ç–∫–ª—é—á–∏—Ç—å KIE.ai API key ‚Üí —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Pexels
2. –û—Ç–∫–ª—é—á–∏—Ç—å Instagram API ‚Üí —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å IG, –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
3. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å 10 –ø–æ—Å—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ –≤—Ä–µ–º—è ‚Üí –≤—Å–µ –¥–æ–ª–∂–Ω—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–°–æ–∑–¥–∞—Ç—å Dashboard (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- Google Sheets: —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- Telegram channel: –ª–æ–≥–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- n8n Executions: –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤

---

## –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- n8n self-hosted: $0/–º–µ—Å—è—Ü (—É–∂–µ –µ—Å—Ç—å –Ω–∞ VPS)
- Google Drive: $0/–º–µ—Å—è—Ü (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞)
- Telegram Bot: $0/–º–µ—Å—è—Ü (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

### AI —Å–µ—Ä–≤–∏—Å—ã (–Ω–∞ 60 –ø–æ—Å—Ç–æ–≤/–º–µ—Å—è—Ü, ~2/–¥–µ–Ω—å)

**–í–∞—Ä–∏–∞–Ω—Ç A: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (Recommended)**
```
–ò—Å—Ç–æ—á–Ω–∏–∫–∏:
- 70% WordPress Gallery: 42 –ø–æ—Å—Ç–∞ √ó $0 = $0
- 30% KIE.ai Images: 18 –ø–æ—Å—Ç–æ–≤ √ó $0.04 = $0.72

–¢–µ–∫—Å—Ç:
- OpenAI GPT-4: 60 –ø–æ—Å—Ç–æ–≤ √ó $0.02 = $1.20

–ò—Ç–æ–≥–æ: $1.92/–º–µ—Å—è—Ü
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**
```
–ò—Å—Ç–æ—á–Ω–∏–∫–∏:
- 50% WordPress: 30 –ø–æ—Å—Ç–æ–≤ √ó $0 = $0
- 40% KIE.ai Images: 24 –ø–æ—Å—Ç–∞ √ó $0.04 = $0.96
- 10% KIE.ai Video: 6 –ø–æ—Å—Ç–æ–≤ √ó $0.40 = $2.40

–¢–µ–∫—Å—Ç: $1.20

–ò—Ç–æ–≥–æ: $4.56/–º–µ—Å—è—Ü
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–µ–º–∏—É–º (–º–Ω–æ–≥–æ –≤–∏–¥–µ–æ)**
```
–ò—Å—Ç–æ—á–Ω–∏–∫–∏:
- 20% WordPress: 12 –ø–æ—Å—Ç–æ–≤ √ó $0 = $0
- 30% KIE.ai Images: 18 –ø–æ—Å—Ç–æ–≤ √ó $0.04 = $0.72
- 50% KIE.ai Video: 30 –ø–æ—Å—Ç–æ–≤ √ó $0.40 = $12.00

–¢–µ–∫—Å—Ç: $1.20

–ò—Ç–æ–≥–æ: $13.92/–º–µ—Å—è—Ü
```

---

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: KIE.ai –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å (Sora 2 API)
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Veo 3.1 –≤–º–µ—Å—Ç–æ Sora 2 (–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ)
- Fallback –Ω–∞ Pexels –¥–ª—è —Ñ–æ—Ç–æ
- Fallback –Ω–∞ WordPress Gallery

### –†–∏—Å–∫ 2: Instagram API rate limits
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –õ–∏–º–∏—Ç: 25 –ø–æ—Å—Ç–æ–≤/—á–∞—Å
- –ù–∞—à –ø–ª–∞–Ω: –º–∞–∫—Å–∏–º—É–º 2 –ø–æ—Å—Ç–∞/–¥–µ–Ω—å = –±–µ–∑–æ–ø–∞—Å–Ω–æ
- Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff

### –†–∏—Å–∫ 3: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ AI —Ç–µ–∫—Å—Ç–æ–≤
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –¢—â–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤
- Preview –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π (–≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)

### –†–∏—Å–∫ 4: WordPress NextGEN Gallery –ø—É—Å—Ç–∞—è
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≥–∞–ª–µ—Ä–µ–π –≤ –Ω–∞—á–∞–ª–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ AI/Pexels

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 7: –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–±—É–¥—É—â–µ–µ)
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–π (likes, comments, reach)
- Dashboard –≤ Google Sheets
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

### –§–∞–∑–∞ 8: –£–ª—É—á—à–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏–¥–æ–≤ –∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. **n8n_workflows/master_router.json**
   - –ü—Ä–∏—á–∏–Ω–∞: Entry point —Å–∏—Å—Ç–µ–º—ã, –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –∑–¥–µ—Å—å

2. **n8n_workflows/content_generator.json**
   - –ü—Ä–∏—á–∏–Ω–∞: –°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π workflow, 70% –ª–æ–≥–∏–∫–∏

3. **n8n_workflows/publisher.json**
   - –ü—Ä–∏—á–∏–Ω–∞: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

4. **n8n_workflows/scheduler.json**
   - –ü—Ä–∏—á–∏–Ω–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

5. **n8n_workflows/schedule_executor.json**
   - –ü—Ä–∏—á–∏–Ω–∞: Cron job –¥–ª—è –∞–≤—Ç–æ–ø—É–±–ª–∏–∫–∞—Ü–∏–∏

6. **config/ai_prompts.json** (—Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
   - –ü—Ä–∏—á–∏–Ω–∞: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ AI –ø—Ä–æ–º–ø—Ç–æ–≤

7. **config/platform_specs.json** (—Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
   - –ü—Ä–∏—á–∏–Ω–∞: –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

8. **Google Sheet: "ContentFactory Schedule"**
   - –ü—Ä–∏—á–∏–Ω–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

---

## –û–±—â–µ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–§–∞–∑–∞ 1 (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞):** 2-3 —á–∞—Å–∞
- **–§–∞–∑–∞ 2 (Master Router):** 1-2 —á–∞—Å–∞
- **–§–∞–∑–∞ 3 (Content Generator):** 4-5 —á–∞—Å–æ–≤
- **–§–∞–∑–∞ 4 (Publisher):** 3-4 —á–∞—Å–∞
- **–§–∞–∑–∞ 5 (Scheduler):** 1-2 —á–∞—Å–∞
- **–§–∞–∑–∞ 6 (Gallery Browser):** 1-2 —á–∞—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞:** 3-4 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ: 15-22 —á–∞—Å–∞** (2-3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω—è)

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ credentials –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ n8n Credentials Manager –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- Google Sheets –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤–º–µ—Å—Ç–æ PostgreSQL –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø–æ–∑–∂–µ)
- Telegram Bot Token –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ @BotFather
- Meta Business API —Ç—Ä–µ–±—É–µ—Ç –±–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç –∏ review permissions
- KIE.ai API key —É–∂–µ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ n8n credentials

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–æ–≤ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π

### –£–∂–µ –µ—Å—Ç—å (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π):
‚úÖ **n8n API Key** ‚Äî —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ Windows Credential Manager via keyring
- –õ–æ–∫–∞—Ü–∏—è: `keyring.get_password('arkhos', 'n8n_api_key')`
- URL: https://n8n.studiokook.ee
- –°—Ç–∞—Ç—É—Å: –†–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

‚úÖ **Telegram Bot**
- Bot Token: `8009187517:AAGBSalSZHGxZtHpw0mShe_8uJ_QByk5igU`
- Chat ID: `804465999`
- Bot Name: `lagedi_bot`
- –õ–æ–∫–∞—Ü–∏—è: `C:\Users\sorte\Desktop\.claude\secrets\telegram.json`

‚úÖ **KIE.ai Account**
- –õ–æ–≥–∏–Ω –µ—Å—Ç—å
- –î–µ–ø–æ–∑–∏—Ç –µ—Å—Ç—å
- API Key: –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://kie.ai/api-key

### –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

‚ö†Ô∏è **OpenAI API Key**
- –ü–æ–ª—É—á–∏—Ç—å –Ω–∞ https://platform.openai.com/api-keys
- –î–æ–±–∞–≤–∏—Ç—å –≤ n8n credentials (—Ç–∏–ø: OpenAI API)

‚ö†Ô∏è **Pexels API Key** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è fallback)
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π: https://www.pexels.com/api/
- –î–æ–±–∞–≤–∏—Ç—å –≤ n8n credentials (—Ç–∏–ø: Header Auth)

‚ö†Ô∏è **Meta Business API** (–¥–ª—è Instagram/Facebook)
- –¢—Ä–µ–±—É–µ—Ç Facebook Business Account
- –ü–æ–ª—É—á–∏—Ç—å Access Token —á–µ—Ä–µ–∑ Meta for Developers
- Scope: `instagram_basic`, `instagram_content_publish`, `pages_manage_posts`
- –î–æ–±–∞–≤–∏—Ç—å –≤ n8n credentials (—Ç–∏–ø: OAuth2)

‚ö†Ô∏è **WordPress MCP Endpoint**
- URL: –Ω—É–∂–Ω–æ —É–∑–Ω–∞—Ç—å URL WordPress MCP adapter
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π REST API WordPress

### –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –§–∞–∑—ã 1:

1. ‚òê –ü–æ–ª—É—á–∏—Ç—å KIE.ai API Key
2. ‚òê –ü–æ–ª—É—á–∏—Ç—å OpenAI API Key
3. ‚òê –ü–æ–ª—É—á–∏—Ç—å Pexels API Key (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. ‚òê –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Meta Business API (–µ—Å–ª–∏ —Ö–æ—Ç–∏–º –∞–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ –≤ Instagram)
5. ‚òê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL WordPress –¥–ª—è NextGEN Gallery API
6. ‚òê –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Telegram Bot –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `lagedi_bot`
7. ‚òê –°–æ–∑–¥–∞—Ç—å Google Sheet "ContentFactory Schedule"

